/*! angular-openlayers-directive 17-06-2016 */
angular.module("openlayers-directive",["ngSanitize"]).directive("openlayers",["$log","$q","$compile","olHelpers","olMapDefaults","olData",function(a,b,c,d,e,f){return{restrict:"EA",transclude:!0,replace:!0,scope:{center:"=olCenter",defaults:"=olDefaults",view:"=olView",events:"=olEvents"},template:'<div class="angular-openlayers-map" ng-transclude></div>',controller:["$scope",function(a){var c=b.defer();a.getMap=function(){return c.promise},a.setMap=function(a){c.resolve(a)},this.getOpenlayersScope=function(){return a}}],link:function(a,b,c){var g=d.isDefined,h=d.createLayer,i=d.setMapEvents,j=d.setViewEvents,k=d.createView,l=e.setDefaults(a);g(c.width)&&(isNaN(c.width)?b.css("width",c.width):b.css("width",c.width+"px")),g(c.height)&&(isNaN(c.height)?b.css("height",c.height):b.css("height",c.height+"px")),g(c.lat)&&(l.center.lat=parseFloat(c.lat)),g(c.lon)&&(l.center.lon=parseFloat(c.lon)),g(c.zoom)&&(l.center.zoom=parseFloat(c.zoom));var m=ol.control.defaults(l.controls),n=ol.interaction.defaults(l.interactions),o=k(l.view),p=new ol.Map({target:b[0],controls:m,interactions:n,renderer:l.renderer,view:o,loadTilesWhileAnimating:l.loadTilesWhileAnimating,loadTilesWhileInteracting:l.loadTilesWhileInteracting});if(a.$on("$destroy",function(){f.resetMap(c.id)}),!c.customLayers){var q={type:"Tile",source:{type:"OSM"}},r=h(q,o.getProjection(),"default");p.addLayer(r),p.set("default",!0)}if(!g(c.olCenter)){var s=ol.proj.transform([l.center.lon,l.center.lat],l.center.projection,o.getProjection());o.setCenter(s),o.setZoom(l.center.zoom)}i(l.events,p,a),j(l.events,p,a),a.setMap(p),f.setMap(p,c.id)}}}]),angular.module("openlayers-directive").directive("olCenter",["$log","$location","olMapDefaults","olHelpers",function(a,b,c,d){return{restrict:"A",scope:!1,replace:!1,require:"openlayers",link:function(e,f,g,h){var i=d.safeApply,j=d.isValidCenter,k=d.isDefined,l=d.isArray,m=d.isNumber,n=d.isSameCenterOnMap,o=d.setCenter,p=d.setZoom,q=h.getOpenlayersScope();q.getMap().then(function(e){var f=c.getDefaults(q),h=e.getView(),r=q.center;if(-1!==g.olCenter.search("-"))return a.error('[AngularJS - Openlayers] The "center" variable can\'t use a "-" on his key name: "'+g.center+'".'),void o(h,f.view.projection,f.center,e);k(r)||(r={}),j(r)||(a.warn("[AngularJS - Openlayers] invalid 'center'"),r.lat=f.center.lat,r.lon=f.center.lon,r.zoom=f.center.zoom,r.projection=f.center.projection),r.projection||("pixel"!==f.view.projection?r.projection=f.center.projection:r.projection="pixel"),m(r.zoom)||(r.zoom=1),o(h,f.view.projection,r,e),h.setZoom(r.zoom);var s;if(r.centerUrlHash===!0){var t=function(){var a,c=b.search();if(k(c.c)){var d=c.c.split(":");3===d.length&&(a={lat:parseFloat(d[0]),lon:parseFloat(d[1]),zoom:parseInt(d[2],10)})}return a};s=t(),q.$on("$locationChangeSuccess",function(){var a=t();a&&!n(a,e)&&i(q,function(b){b.center.lat=a.lat,b.center.lon=a.lon,b.center.zoom=a.zoom})})}var u;q.$watchCollection("center",function(b){if(b){if(b.projection||(b.projection=f.center.projection),b.autodiscover)return u||(u=new ol.Geolocation({projection:ol.proj.get(b.projection)}),u.on("change",function(){if(b.autodiscover){var a=u.getPosition();i(q,function(b){b.center.lat=a[1],b.center.lon=a[0],b.center.zoom=12,b.center.autodiscover=!1,u.setTracking(!1)})}})),void u.setTracking(!0);j(b)||(a.warn("[AngularJS - Openlayers] invalid 'center'"),b=f.center);var c=h.getCenter();if(c)if("pixel"===f.view.projection||"pixel"===b.projection)h.setCenter(b.coord);else{var d=ol.proj.transform(c,f.view.projection,b.projection);d[1]===b.lat&&d[0]===b.lon||o(h,f.view.projection,b,e)}h.getZoom()!==b.zoom&&p(h,b.zoom,e)}}),e.on("moveend",function(){i(q,function(a){if(k(a.center)){var c=e.getView().getCenter();if(a.center.zoom=h.getZoom(),"pixel"===f.view.projection||"pixel"===a.center.projection)return void(a.center.coord=c);if(a.center){var g=ol.proj.transform(c,f.view.projection,a.center.projection);if(a.center.lat=g[1],a.center.lon=g[0],d.notifyCenterUrlHashChanged(q,a.center,b.search()),l(a.center.bounds)){var i=h.calculateExtent(e.getSize()),j=a.center.projection,m=f.view.projection;a.center.bounds=ol.proj.transformExtent(i,m,j)}}}})})})}}}]),angular.module("openlayers-directive").directive("olLayer",["$log","$q","olMapDefaults","olHelpers",function(a,b,c,d){return{restrict:"E",scope:{properties:"=olLayerProperties",onLayerCreated:"&"},replace:!1,require:"^openlayers",link:function(a,b,e,f){var g=d.isDefined,h=d.equals,i=f.getOpenlayersScope(),j=d.createLayer,k=d.setVectorLayerEvents,l=d.detectLayerType,m=d.createStyle,n=d.isBoolean,o=d.addLayerBeforeMarkers,p=d.isNumber,q=d.insertLayer,r=d.removeLayer,s=d.addLayerToGroup,t=d.removeLayerFromGroup,u=d.getGroup;i.getMap().then(function(b){var d,f=b.getView().getProjection(),v=c.setDefaults(i),w=b.getLayers();if(a.$on("$destroy",function(){a.properties.group?t(w,d,a.properties.group):r(w,d.index),b.removeLayer(d)}),g(a.properties))a.$watch("properties",function(c,e){if(g(c.source)&&g(c.source.type)){if(!g(c.visible))return void(c.visible=!0);if(!g(c.opacity))return void(c.opacity=1);var i,x,y;if(g(d)){var z=function(a){return function(b){return b!==a}}(d);if(g(e)&&!h(c.source,e.source)){var A=d.index;y=w,x=d.get("group"),x&&(y=u(w,x).getLayers()),y.removeAt(A),d=j(c,f,a.onLayerCreated),d.set("group",x),g(d)&&(q(y,A,d),"Vector"===l(c)&&k(v.events,b,a,c.name))}(g(e)&&c.opacity!==e.opacity||z(d))&&(p(c.opacity)||p(parseFloat(c.opacity)))&&d.setOpacity(c.opacity),g(c.index)&&c.index!==d.index&&(y=w,x=d.get("group"),x&&(y=u(w,x).getLayers()),r(y,d.index),q(y,c.index,d)),g(c.group)&&c.group!==e.group&&(t(w,d,e.group),s(w,d,c.group)),(g(e)&&n(c.visible)&&c.visible!==e.visible||z(d))&&d.setVisible(c.visible),(g(c.style)&&!h(c.style,e.style)||z(d))&&(i=angular.isFunction(c.style)?c.style:m(c.style),d.setStyle&&angular.isFunction(d.setStyle)&&d.setStyle(i)),h(c.minResolution,e.minResolution)&&!z(d)||g(c.minResolution)&&d.setMinResolution(c.minResolution),h(c.maxResolution,e.maxResolution)&&!z(d)||g(c.maxResolution)&&d.setMaxResolution(c.maxResolution)}else d=j(c,f,a.onLayerCreated),g(c.group)?s(w,d,c.group):g(c.index)?q(w,c.index,d):o(w,d),"Vector"===l(c)&&k(v.events,b,a,c.name),n(c.visible)&&d.setVisible(c.visible),c.opacity&&d.setOpacity(c.opacity),angular.isArray(c.extent)&&d.setExtent(c.extent),c.style&&(i=angular.isFunction(c.style)?c.style:m(c.style),d.setStyle&&angular.isFunction(d.setStyle)&&d.setStyle(i)),c.minResolution&&d.setMinResolution(c.minResolution),c.maxResolution&&d.setMaxResolution(c.maxResolution)}},!0);else if(g(e.sourceType)&&g(e.sourceUrl)){var x={source:{url:e.sourceUrl,type:e.sourceType}};d=j(x,f,e.layerName,a.onLayerCreated),"Vector"===l(x)&&k(v.events,b,a,e.name),o(w,d)}})}}}]),angular.module("openlayers-directive").directive("olPath",["$log","$q","olMapDefaults","olHelpers",function(a,b,c,d){return{restrict:"E",scope:{properties:"=olGeomProperties",style:"=olStyle"},require:"^openlayers",replace:!0,template:'<div class="popup-label path" ng-bind-html="message"></div>',link:function(a,b,e,f){var g=d.isDefined,h=d.createFeature,i=d.createOverlay,j=d.createVectorLayer,k=d.insertLayer,l=d.removeLayer,m=f.getOpenlayersScope();m.getMap().then(function(d){var f=c.getDefaults(m),n=f.view.projection,o=j(),p=d.getLayers();if(k(p,p.getLength(),o),a.$on("$destroy",function(){l(p,o.index)}),g(e.coords)){var q=e.proj||"EPSG:4326",r=JSON.parse(e.coords),s={type:"Polygon",coords:r,projection:q,style:a.style?a.style:f.styles.path},t=h(s,n);if(o.getSource().addFeature(t),e.message){a.message=e.message;var u=t.getGeometry().getExtent(),v=i(b,u);d.addOverlay(v)}}else;})}}}]),angular.module("openlayers-directive").directive("olView",["$log","$q","olData","olMapDefaults","olHelpers",function(a,b,c,d,e){return{restrict:"A",scope:!1,replace:!1,require:"openlayers",link:function(a,b,c,f){var g=f.getOpenlayersScope(),h=e.isNumber,i=e.safeApply,j=e.createView;g.getMap().then(function(a){var b=d.getDefaults(g),c=g.view;c.projection||(c.projection=b.view.projection),c.maxZoom||(c.maxZoom=b.view.maxZoom),c.minZoom||(c.minZoom=b.view.minZoom),c.rotation||(c.rotation=b.view.rotation);var e=j(c);a.setView(e),g.$watchCollection("view",function(a){h(a.rotation)&&e.setRotation(a.rotation)}),e.on("change:rotation",function(){i(g,function(b){b.view.rotation=a.getView().getRotation()})})})}}}]),angular.module("openlayers-directive").directive("olControl",["$log","$q","olData","olMapDefaults","olHelpers",function(a,b,c,d,e){return{restrict:"E",scope:{properties:"=olControlProperties"},replace:!1,require:"^openlayers",link:function(a,b,c,d){var f,g,h=e.isDefined,i=d.getOpenlayersScope();i.getMap().then(function(b){var d=e.getControlClasses,i=d();return a.$on("$destroy",function(){b.removeControl(f)}),h(a.properties)&&h(a.properties.control)?(f=a.properties.control,void b.addControl(f)):void(c.name&&(h(a.properties)&&(g=a.properties),f=new i[c.name](g),b.addControl(f)))})}}}]),angular.module("openlayers-directive").directive("olMarker",["$log","$q","olMapDefaults","olHelpers",function(a,b,c,d){var e=function(){return{projection:"EPSG:4326",lat:0,lon:0,coord:[],show:!0,showOnMouseOver:!1,showOnMouseClick:!1,keepOneOverlayVisible:!1}},f=function(){function a(a){return b.map(function(a){return a.map}).indexOf(a)}var b=[];return{getInst:function(c,e){var f=a(e);if(-1===f){var g=d.createVectorLayer();g.set("markers",!0),e.addLayer(g),b.push({map:e,markerLayer:g,instScopes:[]}),f=b.length-1}return b[f].instScopes.push(c),b[f].markerLayer},deregisterScope:function(c,d){var e=a(d);if(-1===e)throw Error("This map has no markers");var f=b[e].instScopes,g=f.indexOf(c);if(-1===g)throw Error("Scope wan't registered");f.splice(g,1),f.length||(d.removeLayer(b[e].markerLayer),delete b[e])}}}();return{restrict:"E",scope:{lat:"=lat",lon:"=lon",label:"=label",properties:"=olMarkerProperties",style:"=olStyle"},transclude:!0,require:"^openlayers",replace:!0,template:'<div class="popup-label marker"><div ng-bind-html="message"></div><ng-transclude></ng-transclude></div>',link:function(b,g,h,i){var j=d.isDefined,k=i.getOpenlayersScope(),l=d.createFeature,m=d.createOverlay,n=g.find("ng-transclude").children().length>0;k.getMap().then(function(d){function i(a){var c=a.coordinate,e=d.getView().getProjection().getCode();if(c="pixel"===e?c.map(function(a){return parseInt(a,10)}):ol.proj.transform(c,e,"EPSG:4326"),"pointerdown"===a.type){var f=d.forEachFeatureAtPixel(a.pixel,function(a){return a});if(w=f?f.get("marker"):null,!w||!w.draggable)return void(w=null);d.getTarget().style.cursor="pointer",v="pixel"===e?[c[0]-w.coord[0],c[1]-w.coord[1]]:[c[0]-w.lon,c[1]-w.lat],a.preventDefault()}else v&&w&&("pointerup"===a.type?(d.getTarget().style.cursor="",v=null,w=null,a.preventDefault()):"pointerdrag"===a.type&&(a.preventDefault(),b.$apply(function(){"pixel"===e?(w.coord[0]=c[0]-v[0],w.coord[1]=c[1]-v[1]):(w.lon=c[0]-v[0],w.lat=c[1]-v[1])})))}var o,p,q,r=f.getInst(b,d),s=e(),t=c.getDefaults(k),u=t.view.projection,v=null,w=null;return d.on("pointerdown",i),d.on("pointerup",i),d.on("pointerdrag",i),b.$on("$destroy",function(){r.getSource().removeFeature(q),j(o)&&d.removeOverlay(o),f.deregisterScope(b,d)}),j(b.properties)?void b.$watch("properties",function(c){if(d.getViewport().removeEventListener("mousemove",c.handleInteraction),d.getViewport().removeEventListener("click",c.handleTapInteraction),d.getViewport().querySelector("canvas.ol-unselectable").removeEventListener("touchend",c.handleTapInteraction),d.getViewport().removeEventListener("mousemove",c.showAtLeastOneOverlay),d.getViewport().removeEventListener("click",c.removeAllOverlays),c.handleInteraction=function(a){var b=!1;if(h.hasOwnProperty("ngClick")&&(b=!0),!c.label.show||b){var e=!1,f=d.getEventPixel(a),i=d.forEachFeatureAtPixel(f,function(a){return a}),k=!1;if(i===q){if(k=!0,e=!0,b&&("click"===a.type||"touchend"===a.type))return g.triggerHandler("click"),a.preventDefault(),void a.stopPropagation();j(o)||(p="pixel"===s.projection?c.coord:ol.proj.transform([c.lon,c.lat],s.projection,u),o=m(g,p),d.addOverlay(o)),d.getTarget().style.cursor="pointer"}!e&&o&&(k=!0,d.removeOverlay(o),o=void 0,d.getTarget().style.cursor=""),k&&a.preventDefault()}},c.handleTapInteraction=function(){function a(){e=!0,b&&clearTimeout(b),b=setTimeout(function(){e=!1,b=null},500)}var b,e=!1;return d.getViewport().querySelector("canvas.ol-unselectable").addEventListener("touchmove",a),function(){e||(c.handleInteraction.apply(null,arguments),a())}}(),c.showAtLeastOneOverlay=function(a){if(!c.label.show){var b=!1,e=d.getEventPixel(a),f=d.forEachFeatureAtPixel(e,function(a){return a}),h=!1;f===q&&(h=!0,b=!0,j(o)||(p="pixel"===s.projection?s.coord:ol.proj.transform([s.lon,s.lat],s.projection,u),o=m(g,p),angular.forEach(d.getOverlays(),function(a){d.removeOverlay(a)}),d.addOverlay(o)),d.getTarget().style.cursor="pointer"),!b&&o&&(h=!0,o=void 0,d.getTarget().style.cursor=""),h&&a.preventDefault()}},c.removeAllOverlays=function(a){angular.forEach(d.getOverlays(),function(a){d.removeOverlay(a)}),a.preventDefault()},j(q)){var e;if(e="pixel"===c.projection?c.coord:ol.proj.transform([c.lon,c.lat],s.projection,d.getView().getProjection()),!angular.equals(q.getGeometry().getCoordinates(),e)){var f=new ol.geom.Point(e);q.setGeometry(f)}}else s.projection=c.projection?c.projection:s.projection,s.coord=c.coord?c.coord:s.coord,s.lat=c.lat?c.lat:s.lat,s.lon=c.lon?c.lon:s.lon,j(c.style)?s.style=c.style:s.style=t.styles.marker,q=l(s,u),j(q)||a.error("[AngularJS - Openlayers] Received invalid data on the marker."),q.set("marker",c),r.getSource().addFeature(q);j(o)&&d.removeOverlay(o),j(c.label)&&(b.message=c.label.message,(n||j(b.message)&&0!==b.message.length)&&(c.label&&c.label.show===!0&&(p="pixel"===s.projection?s.coord:ol.proj.transform([c.lon,c.lat],s.projection,u),o=m(g,p),d.addOverlay(o)),o&&c.label&&c.label.show===!1&&(d.removeOverlay(o),o=void 0),c.label&&c.label.show===!1&&c.label.showOnMouseOver&&d.getViewport().addEventListener("mousemove",c.handleInteraction),(c.label&&c.label.show===!1&&c.label.showOnMouseClick||h.hasOwnProperty("ngClick"))&&(d.getViewport().addEventListener("click",c.handleTapInteraction),d.getViewport().querySelector("canvas.ol-unselectable").addEventListener("touchend",c.handleTapInteraction)),c.label&&c.label.show===!1&&c.label.keepOneOverlayVisible&&(d.getViewport().addEventListener("mousemove",c.showAtLeastOneOverlay),d.getViewport().addEventListener("click",c.removeAllOverlays))))},!0):(s.lat=b.lat?b.lat:s.lat,s.lon=b.lon?b.lon:s.lon,s.message=h.message,s.style=b.style?b.style:t.styles.marker,q=l(s,u),j(q)||a.error("[AngularJS - Openlayers] Received invalid data on the marker."),q.set("marker",b),r.getSource().addFeature(q),void((s.message||n)&&(b.message=h.message,p=ol.proj.transform([s.lon,s.lat],s.projection,u),o=m(g,p),d.addOverlay(o))))})}}}]),angular.module("openlayers-directive").service("olData",["$log","$q",function(a,b){function c(b,c){var d,e;if(angular.isDefined(c))d=c;else if(1===Object.keys(b).length)for(e in b)b.hasOwnProperty(e)&&(d=e);else 0===Object.keys(b).length?d="main":a.error("[AngularJS - Openlayers] - You have more than 1 map on the DOM, you must provide the map ID to the olData.getXXX call");return d}var d={},e=function(a,b){var d=c(a,b);a[d].resolvedDefer=!0},f=function(a,d){var e,f=c(a,d);return angular.isDefined(a[f])&&a[f].resolvedDefer!==!0?e=a[f].defer:(e=b.defer(),a[f]={defer:e,resolvedDefer:!1}),e},g=function(a,b){var d,e=c(a,b);return d=angular.isDefined(a[e])&&a[e].resolvedDefer!==!1?a[e].defer:f(a,b)};this.setMap=function(a,b){var c=f(d,b);c.resolve(a),e(d,b)},this.getMap=function(a){var b=g(d,a);return b.promise},this.resetMap=function(a){angular.isDefined(d[a])&&delete d[a]}}]),angular.module("openlayers-directive").factory("olHelpers",["$q","$log","$http",function(a,b,c){var d=function(a){return angular.isDefined(a)},e=function(a){return angular.isDefined(a)&&null!==a},f=function(a,b,c){a.on(b,function(d){var e=d.coordinate,f=a.getView().getProjection().getCode();"pixel"===f&&(e=e.map(function(a){return parseInt(a,10)})),c.$emit("openlayers.map."+b,{coord:e,projection:f,event:d})})},g=["Road","Aerial","AerialWithLabels","collinsBart","ordnanceSurvey"],h=function(){return{attribution:ol.control.Attribution,fullscreen:ol.control.FullScreen,mouseposition:ol.control.MousePosition,overviewmap:ol.control.OverviewMap,rotate:ol.control.Rotate,scaleline:ol.control.ScaleLine,zoom:ol.control.Zoom,zoomslider:ol.control.ZoomSlider,zoomtoextent:ol.control.ZoomToExtent}},i=["osm","sat","hyb"],j=["World_Imagery","World_Street_Map","World_Topo_Map","World_Physical_Map","World_Terrain_Base","Ocean_Basemap","NatGeo_World_Map"],k={style:ol.style.Style,fill:ol.style.Fill,stroke:ol.style.Stroke,circle:ol.style.Circle,icon:ol.style.Icon,image:ol.style.Image,regularshape:ol.style.RegularShape,text:ol.style.Text},l=function(a,b){return b&&a instanceof b?a:b?new b(a):a},m=function x(a,b){var c;if(b?c=a[b]:(b="style",c=a),"style"===b&&a instanceof Function)return a;if(!(c instanceof Object))return c;var d;if("[object Object]"===Object.prototype.toString.call(c)){d={};var e=k[b];if(e&&c instanceof e)return c;Object.getOwnPropertyNames(c).forEach(function(a,f,g){var h=k[a];return e&&h&&h.prototype instanceof k[b]?(console.assert(1===g.length,"Extra parameters for "+b),d=x(c,a),l(d,h)):(d[a]=x(c,a),void("text"!==a&&"string"!=typeof d[a]&&(d[a]=l(d[a],k[a]))))})}else d=c;return l(d,k[b])},n=function(a){if(a.type)return a.type;switch(a.source.type){case"ImageWMS":return"Image";case"ImageStatic":return"Image";case"GeoJSON":case"JSONP":case"TopoJSON":case"KML":return"Vector";case"TileVector":return"TileVector";default:return"Tile"}},o=function(a){var c;switch(a.projection){case"pixel":if(!d(a.extent))return void b.error("[AngularJS - Openlayers] - You must provide the extent of the image if using pixel projection");c=new ol.proj.Projection({code:"pixel",units:"pixels",extent:a.extent});break;default:c=new ol.proj.get(a.projection)}return c},p=function(a){return-1!==["watercolor","terrain","toner"].indexOf(a)},q=function(a,e){var f,h,k=new ol.format.GeoJSON;switch(a.type){case"MapBox":if(!a.mapId||!a.accessToken)return void b.error("[AngularJS - Openlayers] - MapBox layer requires the map id and the access token");h="http://api.tiles.mapbox.com/v4/"+a.mapId+"/{z}/{x}/{y}.png?access_token="+a.accessToken;var l=window.devicePixelRatio;l>1&&(h=h.replace(".png","@2x.png")),f=new ol.source.XYZ({url:h,attributions:s(a),tilePixelRatio:l>1?2:1});break;case"MapBoxStudio":if(!a.mapId||!a.accessToken||!a.userId)return void b.error("[AngularJS - Openlayers] - MapBox Studio layer requires the map id, user id  and the access token");h="https://api.mapbox.com/styles/v1/"+a.userId+"/"+a.mapId+"/tiles/{z}/{x}/{y}?access_token="+a.accessToken,f=new ol.source.XYZ({url:h,attributions:s(a),tileSize:a.tileSize||[512,512]});break;case"ImageWMS":a.url&&a.params||b.error("[AngularJS - Openlayers] - ImageWMS Layer needs valid server url and params properties"),f=new ol.source.ImageWMS({url:a.url,attributions:s(a),crossOrigin:"undefined"==typeof a.crossOrigin?"anonymous":a.crossOrigin,params:r(a.params),ratio:a.ratio});break;case"TileWMS":(a.url||a.urls)&&a.params||b.error("[AngularJS - Openlayers] - TileWMS Layer needs valid url (or urls) and params properties");var m={crossOrigin:"undefined"==typeof a.crossOrigin?"anonymous":a.crossOrigin,params:r(a.params),attributions:s(a)};a.serverType&&(m.serverType=a.serverType),a.url&&(m.url=a.url),a.urls&&(m.urls=a.urls),f=new ol.source.TileWMS(m);break;case"WMTS":(a.url||a.urls)&&a.tileGrid||b.error("[AngularJS - Openlayers] - WMTS Layer needs valid url (or urls) and tileGrid properties");var n={projection:e,layer:a.layer,attributions:s(a),matrixSet:"undefined"===a.matrixSet?e:a.matrixSet,format:"undefined"===a.format?"image/jpeg":a.format,requestEncoding:"undefined"===a.requestEncoding?"KVP":a.requestEncoding,tileGrid:new ol.tilegrid.WMTS({origin:a.tileGrid.origin,resolutions:a.tileGrid.resolutions,matrixIds:a.tileGrid.matrixIds}),style:"undefined"===a.style?"normal":a.style};d(a.url)&&(n.url=a.url),d(a.urls)&&(n.urls=a.urls),f=new ol.source.WMTS(n);break;case"OSM":f=new ol.source.OSM({attributions:s(a)}),a.url&&f.setUrl(a.url);break;case"BingMaps":if(!a.key)return void b.error("[AngularJS - Openlayers] - You need an API key to show the Bing Maps.");var o={key:a.key,attributions:s(a),imagerySet:a.imagerySet?a.imagerySet:g[0],culture:a.culture};a.maxZoom&&(o.maxZoom=a.maxZoom),f=new ol.source.BingMaps(o);break;case"MapQuest":if(!a.layer||-1===i.indexOf(a.layer))return void b.error("[AngularJS - Openlayers] - MapQuest layers needs a valid 'layer' property.");f=new ol.source.MapQuest({attributions:s(a),layer:a.layer});break;case"EsriBaseMaps":if(!a.layer||-1===j.indexOf(a.layer))return void b.error("[AngularJS - Openlayers] - ESRI layers needs a valid 'layer' property.");var q="http://services.arcgisonline.com/ArcGIS/rest/services/",t=q+a.layer+"/MapServer/tile/{z}/{y}/{x}";f=new ol.source.XYZ({attributions:s(a),url:t});break;case"GeoJSON":if(!a.geojson&&!a.url)return void b.error("[AngularJS - Openlayers] - You need a geojson property to add a GeoJSON layer.");if(d(a.url))f=new ol.source.Vector({format:new ol.format.GeoJSON,url:a.url});else{f=new ol.source.Vector;var u,v=e;u=d(a.geojson.projection)?new ol.proj.get(a.geojson.projection):e;var w=k.readFeatures(a.geojson.object,{featureProjection:v,dataProjection:u});f.addFeatures(w)}break;case"JSONP":if(!a.url)return void b.error("[AngularJS - Openlayers] - You need an url properly configured to add a JSONP layer.");d(a.url)&&(f=new ol.source.ServerVector({format:k,loader:function(){var d=a.url+"&outputFormat=text/javascript&format_options=callback:JSON_CALLBACK";c.jsonp(d,{cache:a.cache}).success(function(a){f.addFeatures(k.readFeatures(a))}).error(function(a){b(a)})},projection:e}));break;case"TopoJSON":if(!a.topojson&&!a.url)return void b.error("[AngularJS - Openlayers] - You need a topojson property to add a TopoJSON layer.");f=a.url?new ol.source.Vector({format:new ol.format.TopoJSON,url:a.url}):new ol.source.Vector(angular.extend(a.topojson,{format:new ol.format.TopoJSON}));break;case"TileJSON":f=new ol.source.TileJSON({url:a.url,attributions:s(a),crossOrigin:"anonymous"});break;case"TileVector":a.url&&a.format||b.error("[AngularJS - Openlayers] - TileVector Layer needs valid url and format properties"),f=new ol.source.VectorTile({url:a.url,projection:e,attributions:s(a),format:a.format,tileGrid:new ol.tilegrid.createXYZ({maxZoom:a.maxZoom||19})});break;case"TileTMS":a.url&&a.tileGrid||b.error("[AngularJS - Openlayers] - TileTMS Layer needs valid url and tileGrid properties"),f=new ol.source.TileImage({url:a.url,maxExtent:a.maxExtent,attributions:s(a),tileGrid:new ol.tilegrid.TileGrid({origin:a.tileGrid.origin,resolutions:a.tileGrid.resolutions}),tileUrlFunction:function(b){var c=b[0],d=b[1],e=b[2];if(0>d||0>e)return"";var f=a.url+c+"/"+d+"/"+e+".png";return f}});break;case"TileImage":f=new ol.source.TileImage({url:a.url,attributions:s(a),tileGrid:new ol.tilegrid.TileGrid({origin:a.tileGrid.origin,resolutions:a.tileGrid.resolutions}),tileUrlFunction:function(b){var c=b[0],d=b[1],e=-b[2]-1,f=a.url.replace("{z}",c.toString()).replace("{x}",d.toString()).replace("{y}",e.toString());return f}});break;case"KML":var x=a.extractStyles||!1;f=new ol.source.Vector({url:a.url,format:new ol.format.KML,radius:a.radius,extractStyles:x});break;case"Stamen":if(!a.layer||!p(a.layer))return void b.error("[AngularJS - Openlayers] - You need a valid Stamen layer.");f=new ol.source.Stamen({layer:a.layer});break;case"ImageStatic":if(!a.url||!angular.isArray(a.imageSize)||2!==a.imageSize.length)return void b.error("[AngularJS - Openlayers] - You need a image URL to create a ImageStatic layer.");f=new ol.source.ImageStatic({url:a.url,attributions:s(a),imageSize:a.imageSize,projection:e,imageExtent:e.getExtent(),imageLoadFunction:a.imageLoadFunction});break;case"XYZ":a.url||a.tileUrlFunction||b.error("[AngularJS - Openlayers] - XYZ Layer needs valid url or tileUrlFunction properties"),f=new ol.source.XYZ({url:a.url,attributions:s(a),minZoom:a.minZoom,maxZoom:a.maxZoom,projection:a.projection,tileUrlFunction:a.tileUrlFunction});break;case"Zoomify":a.url&&angular.isArray(a.imageSize)&&2===a.imageSize.length||b.error("[AngularJS - Openlayers] - Zoomify Layer needs valid url and imageSize properties"),f=new ol.source.Zoomify({url:a.url,size:a.imageSize})}return f||b.warn('[AngularJS - Openlayers] - No source could be found for type "'+a.type+'"'),f},r=function(a){var b=a;if(a&&"object"==typeof a){b="[object Array]"===Object.prototype.toString.call(a)?[]:{};for(var c in a)b[c]=r(a[c])}return b},s=function(a){var b=[];return d(a.attribution)&&b.unshift(new ol.Attribution({html:a.attribution})),b},t=function(a){var b=new ol.layer.Group;return b.set("name",a),b},u=function(a,b){var c;return angular.forEach(a,function(a){return a instanceof ol.layer.Group&&a.get("name")===b?void(c=a):void 0}),c},v=function(a,b){for(var c,e=0;e<a.getLength();e++){var f=a.item(e);if(f.get("markers")){c=e;break}}if(d(c)){var g=a.item(c);b.index=c,a.setAt(c,b),g.index=a.getLength(),a.push(g)}else b.index=a.getLength(),a.push(b)},w=function(a,b){a.removeAt(b);for(var c=b;c<a.getLength();c++){var d=a.item(c);if(null===d){a.insertAt(c,null);break}d.index=c}};return{isDefined:d,isNumber:function(a){return angular.isNumber(a)},createView:function(a){var b=o(a),c={projection:b,maxZoom:a.maxZoom,minZoom:a.minZoom};return a.center&&(c.center=a.center),a.extent&&(c.extent=a.extent),a.zoom&&(c.zoom=a.zoom),a.resolutions&&(c.resolutions=a.resolutions),new ol.View(c)},isDefinedAndNotNull:e,isString:function(a){return angular.isString(a)},isArray:function(a){return angular.isArray(a)},isObject:function(a){return angular.isObject(a)},equals:function(a,b){return angular.equals(a,b)},isValidCenter:function(a){return angular.isDefined(a)&&("boolean"==typeof a.autodiscover||angular.isNumber(a.lat)&&angular.isNumber(a.lon)||angular.isArray(a.coord)&&2===a.coord.length&&angular.isNumber(a.coord[0])&&angular.isNumber(a.coord[1])||angular.isArray(a.bounds)&&4===a.bounds.length&&angular.isNumber(a.bounds[0])&&angular.isNumber(a.bounds[1])&&angular.isNumber(a.bounds[1])&&angular.isNumber(a.bounds[2]))},safeApply:function(a,b){var c=a.$root.$$phase;"$apply"===c||"$digest"===c?a.$eval(b):a.$apply(b)},isSameCenterOnMap:function(a,b){var c=a.projection||"EPSG:4326",d=[a.lon,a.lat],e=b.getView().getProjection(),f=ol.proj.transform(b.getView().getCenter(),e,c),g=b.getView().getZoom();return f[1].toFixed(4)===d[1].toFixed(4)&&f[0].toFixed(4)===d[0].toFixed(4)&&g===a.zoom},setCenter:function(a,b,c,d){if(d&&a.getCenter()){var e=ol.animation.pan({duration:150,source:a.getCenter()});d.beforeRender(e)}if(c.projection===b)a.setCenter([c.lon,c.lat]);else{var f=[c.lon,c.lat];a.setCenter(ol.proj.transform(f,c.projection,b))}},setZoom:function(a,b,c){var d=ol.animation.zoom({duration:150,resolution:c.getView().getResolution()});c.beforeRender(d),a.setZoom(b)},isBoolean:function(a){return"boolean"==typeof a},createStyle:m,setMapEvents:function(a,b,c){if(d(a)&&angular.isArray(a.map))for(var e in a.map){var g=a.map[e];f(b,g,c)}},setVectorLayerEvents:function(a,b,c,f){d(a)&&angular.isArray(a.layers)&&angular.forEach(a.layers,function(a){angular.element(b.getViewport()).on(a,function(d){var g=b.getEventPixel(d),h=b.forEachFeatureAtPixel(g,function(a,b){return e(b)&&b.get("name")===f?a:null});e(h)&&c.$emit("openlayers.layers."+f+"."+a,h,d)})})},setViewEvents:function(a,b,c){if(d(a)&&angular.isArray(a.view)){var e=b.getView();angular.forEach(a.view,function(a){e.on(a,function(b){c.$emit("openlayers.view."+a,e,b)})})}},detectLayerType:n,createLayer:function(a,b,c,f){var g,h=n(a),i=q(a.source,b);if(i){"function"!=typeof c||f||(f=c,c=void 0),"Vector"===h&&a.clustering&&(i=new ol.source.Cluster({source:i,distance:a.clusteringDistance}));var j={source:i};switch(e(a.opacity)&&(j.opacity=a.opacity),e(a.visible)&&(j.visible=a.visible),e(a.extent)&&(j.extent=a.extent),e(a.zIndex)&&(j.zIndex=a.zIndex),e(a.minResolution)&&(j.minResolution=a.minResolution),e(a.maxResolution)&&(j.maxResolution=a.maxResolution),h){case"Image":g=new ol.layer.Image(j);break;case"Tile":g=new ol.layer.Tile(j);break;case"Heatmap":g=new ol.layer.Heatmap(j);break;case"Vector":g=new ol.layer.Vector(j);break;case"TileVector":g=new ol.layer.VectorTile(j)}if(d(c)?g.set("name",c):d(a.name)&&g.set("name",a.name),d(a.customAttributes))for(var k in a.customAttributes)g.set(k,a.customAttributes[k]);return f&&f({oLayer:g}),g}},createVectorLayer:function(){return new ol.layer.Vector({source:new ol.source.Vector})},notifyCenterUrlHashChanged:function(a,b,c){if(b.centerUrlHash){var e=b.lat.toFixed(4)+":"+b.lon.toFixed(4)+":"+b.zoom;d(c.c)&&c.c===e||a.$emit("centerUrlHash",e)}},getControlClasses:h,detectControls:function(a){var b={},c=h();return a.forEach(function(a){for(var d in c)a instanceof c[d]&&(b[d]=a)}),b},createFeature:function(a,b){var c;switch(a.type){case"Polygon":c=new ol.geom.Polygon(a.coords);break;default:c=d(a.coord)&&"pixel"===a.projection?new ol.geom.Point(a.coord):new ol.geom.Point([a.lon,a.lat])}d(a.projection)&&"pixel"!==a.projection&&(c=c.transform(a.projection,b));var e=new ol.Feature({geometry:c});if(d(a.style)){var f=m(a.style);e.setStyle(f)}return e},addLayerBeforeMarkers:v,getGroup:u,addLayerToGroup:function(a,b,c){var e=u(a,c);d(e)||(e=t(c),v(a,e)),b.set("group",c),v(e.getLayers(),b)},removeLayerFromGroup:function(a,b,c){var d=u(a,c);b.set("group"),w(d.getLayers(),b.index)},removeLayer:w,insertLayer:function(a,b,c){if(a.getLength()<b){for(;a.getLength()<b;){var d=new ol.layer.Image;d.index=a.getLength(),a.push(d)}c.index=b,a.push(c)}else{c.index=b,a.insertAt(c.index,c);for(var e=b+1;e<a.getLength();e++){var f=a.item(e);if(null===f){a.removeAt(e);break}f.index=e}}},createOverlay:function(a,b){a.css("display","block");var c=new ol.Overlay({position:b,element:a[0],positioning:"center-left"});return c}}}]),angular.module("openlayers-directive").factory("olMapDefaults",["$q","olHelpers",function(a,b){var c="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAApCAYAAADAk4LOAAAGmklEQVRYw7VXeUyTZxjvNnfELFuyIzOabermMZEeQC/OclkO49CpOHXOLJl/CAURuYbQi3KLgEhbrhZ1aDwmaoGqKII6odATmH/scDFbdC7LvFqOCc+e95s2VG50X/LLm/f4/Z7neY/ne18aANCmAr5E/xZf1uDOkTcGcWR6hl9247tT5U7Y6SNvWsKT63P58qbfeLJG8M5qcgTknrvvrdDbsT7Ml+tv82X6vVxJE33aRmgSyYtcWVMqX97Yv2JvW39UhRE2HuyBL+t+gK1116ly06EeWFNlAmHxlQE0OMiV6mQCScusKRlhS3QLeVJdl1+23h5dY4FNB3thrbYboqptEFlphTC1hSpJnbRvxP4NWgsE5Jyz86QNNi/5qSUTGuFk1gu54tN9wuK2wc3o+Wc13RCmsoBwEqzGcZsxsvCSy/9wJKf7UWf1mEY8JWfewc67UUoDbDjQC+FqK4QqLVMGGR9d2wurKzqBk3nqIT/9zLxRRjgZ9bqQgub+DdoeCC03Q8j+0QhFhBHR/eP3U/zCln7Uu+hihJ1+bBNffLIvmkyP0gpBZWYXhKussK6mBz5HT6M1Nqpcp+mBCPXosYQfrekGvrjewd59/GvKCE7TbK/04/ZV5QZYVWmDwH1mF3xa2Q3ra3DBC5vBT1oP7PTj4C0+CcL8c7C2CtejqhuCnuIQHaKHzvcRfZpnylFfXsYJx3pNLwhKzRAwAhEqG0SpusBHfAKkxw3w4627MPhoCH798z7s0ZnBJ/MEJbZSbXPhER2ih7p2ok/zSj2cEJDd4CAe+5WYnBCgR2uruyEw6zRoW6/DWJ/OeAP8pd/BGtzOZKpG8oke0SX6GMmRk6GFlyAc59K32OTEinILRJRchah8HQwND8N435Z9Z0FY1EqtxUg+0SO6RJ/mmXz4VuS+DpxXC3gXmZwIL7dBSH4zKE50wESf8qwVgrP1EIlTO5JP9Igu0aexdh28F1lmAEGJGfh7jE6ElyM5Rw/FDcYJjWhbeiBYoYNIpc2FT/SILivp0F1ipDWk4BIEo2VuodEJUifhbiltnNBIXPUFCMpthtAyqws/BPlEF/VbaIxErdxPphsU7rcCp8DohC+GvBIPJS/tW2jtvTmmAeuNO8BNOYQeG8G/2OzCJ3q+soYB5i6NhMaKr17FSal7GIHheuV3uSCY8qYVuEm1cOzqdWr7ku/R0BDoTT+DT+ohCM6/CCvKLKO4RI+dXPeAuaMqksaKrZ7L3FE5FIFbkIceeOZ2OcHO6wIhTkNo0ffgjRGxEqogXHYUPHfWAC/lADpwGcLRY3aeK4/oRGCKYcZXPVoeX/kelVYY8dUGf8V5EBRbgJXT5QIPhP9ePJi428JKOiEYhYXFBqou2Guh+p/mEB1/RfMw6rY7cxcjTrneI1FrDyuzUSRm9miwEJx8E/gUmqlyvHGkneiwErR21F3tNOK5Tf0yXaT+O7DgCvALTUBXdM4YhC/IawPU+2PduqMvuaR6eoxSwUk75ggqsYJ7VicsnwGIkZBSXKOUww73WGXyqP+J2/b9c+gi1YAg/xpwck3gJuucNrh5JvDPvQr0WFXf0piyt8f8/WI0hV4pRxxkQZdJDfDJNOAmM0Ag8jyT6hz0WGXWuP94Yh2jcfjmXAGvHCMslRimDHYuHuDsy2QtHuIavznhbYURq5R57KpzBBRZKPJi8eQg48h4j8SDdowifdIrEVdU+gbO6QNvRRt4ZBthUaZhUnjlYObNagV3keoeru3rU7rcuceqU1mJBxy+BWZYlNEBH+0eH4vRiB+OYybU2hnblYlTvkHinM4m54YnxSyaZYSF6R3jwgP7udKLGIX6r/lbNa9N6y5MFynjWDtrHd75ZvTYAPO/6RgF0k76mQla3FGq7dO+cH8sKn0Vo7nDllwAhqwLPkxrHwWmHJOo+AKJ4rab5OgrM7rVu8eWb2Pu0Dh4eDgXoOfvp7Y7QeqknRmvcTBEyq9m/HQQSCSz6LHq3z0yzsNySRfMS253wl2KyRDbcZPcfJKjZmSEOjcxyi+Y8dUOtsIEH6R2wNykdqrkYJ0RV92H0W58pkfQk7cKevsLK10Py8SdMGfXNXATY+pPbyJR/ET6n9nIfztNtZYRV9XniQu9IA2vOVgy4ir7GCLVmmd+zjkH0eAF9Po6K61pmCXHxU5rHMYd1ftc3owjwRSVRzLjKvqZEty6cRUD7jGqiOdu5HG6MdHjNcNYGqfDm5YRzLBBCCDl/2bk8a8gdbqcfwECu62Fg/HrggAAAABJRU5ErkJggg==",d=function(){
return{view:{projection:"EPSG:3857",minZoom:void 0,maxZoom:void 0,rotation:0,extent:void 0},center:{lat:0,lon:0,zoom:1,autodiscover:!1,bounds:[],centerUrlHash:!1,projection:"EPSG:4326"},styles:{path:{stroke:{color:"blue",width:8}},marker:{image:new ol.style.Icon({anchor:[.5,1],anchorXUnits:"fraction",anchorYUnits:"fraction",opacity:.9,src:c})}},events:{map:[],markers:[],layers:[]},controls:{attribution:!0,rotate:!1,zoom:!0},interactions:{mouseWheelZoom:!1},renderer:"canvas"}},e=b.isDefined,f={};return{getDefaults:function(a){if(!e(a))for(var b in f)return f[b];return f[a.$id]},setDefaults:function(a){var b=a.defaults,c=a.$id,g=d();return e(b)&&(e(b.layers)&&(g.layers=angular.copy(b.layers)),e(b.controls)&&(g.controls=angular.copy(b.controls)),e(b.events)&&(g.events=angular.copy(b.events)),e(b.interactions)&&(g.interactions=angular.copy(b.interactions)),e(b.renderer)&&(g.renderer=b.renderer),e(b.view)&&(g.view.maxZoom=b.view.maxZoom||g.view.maxZoom,g.view.minZoom=b.view.minZoom||g.view.minZoom,g.view.projection=b.view.projection||g.view.projection,g.view.extent=b.view.extent||g.view.extent,g.view.resolutions=b.view.resolutions||g.view.resolutions),e(b.styles)&&(g.styles=angular.extend(g.styles,b.styles)),e(b.loadTilesWhileAnimating)&&(g.loadTilesWhileAnimating=b.loadTilesWhileAnimating),e(b.loadTilesWhileInteracting)&&(g.loadTilesWhileInteracting=b.loadTilesWhileInteracting)),f[c]=g,g}}}]);